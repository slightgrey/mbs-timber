# MBS Timberland :evergreen_tree:

Timberland is an opinionated WordPress theme using [Timber](https://www.upstatement.com/timber/), [Advanced Custom Fields Pro](https://www.advancedcustomfields.com/), [Vite](https://vitejs.dev/), [Tailwind](https://tailwindcss.com/) and [Alpine.js](https://github.com/alpinejs/alpine).

As of version 1.0, Timberland now uses the WordPress block editor to visually edit the site. This is made possible by the [ACF Blocks feature](https://www.advancedcustomfields.com/resources/blocks/).

## Installation

1. Download the zip for this theme (or clone it) and move it to `wp-content/themes` in your WordPress installation.
2. Run `composer install` in the theme directory.
3. Run `npm install` in the theme directory.
4. Activate the theme in Appearance > Themes.
5. Make sure you have installed [Advanced Custom Fields Pro](https://www.advancedcustomfields.com/)

## Development Commands

### Build and Development

- `npm run dev` - Start Vite development server with live reload (runs on localhost:3000)
- `npm run build` - Build production assets (required for block editor previews and production)
- `composer install` - Install PHP dependencies (Timber 2.0)

### Environment Configuration

- Edit `config.json` to switch between development/production Vite environments
- Development mode uses Vite dev server with HMR, production mode uses built assets from manifest.json
- Block editor previews require production build to function properly

### Git Repository Setup

- This directory is not initialized as a Git repository by default
- Run `git init` to initialize, then `git remote add origin <repository-url>` to connect to remote

## Architecture Overview

### WordPress Theme Structure

This is a modern WordPress theme built on the Timber templating engine, combining:

- **Timber 2.0**: PHP templating system using Twig templates with modern architecture
- **Advanced Custom Fields (ACF)**: For custom block creation and field management
- **Vite 6.x**: Modern build tool with ES modules and optimized development server
- **Tailwind CSS 4.x**: Latest version with new plugin system and @tailwindcss/vite integration
- **Alpine.js 3.14**: Lightweight reactive JavaScript framework
- **WooCommerce**: Full e-commerce integration with custom Twig templates
- **Swiper.js**: Modern carousel/slider library for interactive components

### Key Directories

- `theme/` - WordPress theme files (PHP templates, functions, assets)
- `theme/views/` - Twig templates corresponding to WordPress template hierarchy
- `theme/blocks/` - Custom ACF blocks (each block has its own directory)
- `theme/assets/` - Source assets (main.js, CSS files)
- `theme/assets/dist/` - Built assets (generated by Vite)
- `theme/acf-json/` - ACF field group JSON files (auto-generated/updated)

### Block System

Each custom block lives in `theme/blocks/[block-name]/` with:

- `block.json` - Block registration and configuration
- `index.twig` - Block template (access fields via `{{ fields.field_name }}`)
- `style.css` - Block-specific styles (optional)
- `script.js` - Block-specific JavaScript (optional)
- `functions.php` - Block-specific PHP functions (optional)

Blocks are auto-discovered and registered using `DirectoryIterator` in `theme/functions.php`. Block categories include "Custom" and "AspireWeb". Block wrapper removal is enabled via `acf_should_wrap_innerblocks`.

### Asset Pipeline

- Entry points: `theme/assets/main.js` and `theme/assets/styles/editor-style.css`
- Vite automatically imports all block CSS/JS files via `import.meta.glob()` patterns
- Assets are hashed for cache-busting in production and referenced via `.vite/manifest.json`
- Development mode uses Vite dev server with HMR on `localhost:3000` with CORS support
- Production builds include font optimization with `font-display: swap`
- Dual-mode asset loading: development loads from Vite server, production from manifest

### Context and Data Flow

- `Timberland` class extends `Timber\Site` and manages WordPress hooks
- `add_to_context()` method sets global Twig variables (site, menu, etc.)
- Block render callback `acf_block_render_callback()` passes block data to Twig templates
- ACF fields accessible in Twig via `{{ fields.field_name }}`

### Important Configuration

- `Timber::$dirname = array('views', 'blocks')` - Template directories
- `Timber::$autoescape = false` - Disabled for HTML output
- Tailwind content paths include `theme/views/**/*.twig` and `theme/blocks/**/*.twig`
- Tailwind uses extensive safelist with regex patterns for dynamic class generation
- Alpine.js auto-initializes and loads block-specific scripts
- ACF Local JSON enabled for field synchronization in `theme/acf-json/`
- WooCommerce theme support enabled with custom styling overrides
- Font family: Lexend is set as default with fallback to system fonts

### Development Features

- **Editor Autocomplete**: Custom JavaScript provides Tailwind class suggestions in block editor
- **Live Reload**: Vite HMR works with WordPress development environment
- **Font Integration**: Complete Lexend font family (100-900 weights) with variable font support
- **WooCommerce Templates**: Custom Twig templates in `theme/views/woocommerce/`
- **Menu Registration**: Primary and footer menus configured
- **Performance**: Default WordPress block styles removed, custom optimized styles applied
